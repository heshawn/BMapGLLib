"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var BMapGLLib=window.BMapGLLib=BMapGLLib||{};!function(){function t(t){for(var n=[],o=0;o<t.length-1;o++){var i=e(t[o],t[o+1]);n=n.concat(i)}return n=n.concat(t[t.length-1])}function e(t,e){if(t.equals(e))return[t];var i=BMapGL.Projection.getDistance(o(t.lng),o(t.lat),o(e.lng),o(e.lat)),i=BMapGL.Projection.getDistanceByLL(t,e);if(i<25e4)return[t];var r=[],s=Math.round(i/15e4),l=a(t,e);r.push(t);for(var h=0;h<s;h++){var _=n(t,e,h/s,l);r.push(_)}return r.push(e),r}function n(t,e,n,a){var r=t.lat,s=e.lat,l=t.lng,h=e.lng,_=o(r),p=o(s),u=o(l),m=o(h),c=Math.sin((1-n)*a)/Math.sin(a),d=Math.sin(n*a)/Math.sin(a),f=c*Math.cos(_)*Math.cos(u)+d*Math.cos(p)*Math.cos(m),v=c*Math.cos(_)*Math.sin(u)+d*Math.cos(p)*Math.sin(m),g=c*Math.sin(_)+d*Math.sin(p),y=Math.atan2(g,Math.sqrt(Math.pow(f,2)+Math.pow(v,2))),M=Math.atan2(v,f);return new BMapGL.Point(i(M),i(y))}function o(t){return t*Math.PI/180}function i(t){return t/Math.PI*180}function a(t,e){var n=o(t.lat),i=o(e.lat),a=o(t.lng),r=o(e.lng);return Math.acos(Math.sin(n)*Math.sin(i)+Math.cos(n)*Math.cos(i)*Math.cos(Math.abs(r-a)))}function r(t,e,n){this._point=t,this._html=e,this._infoWinClassName=n}var s,l=s=l||{version:"gl 1.0"};l.guid="$BAIDU$",function(){window[l.guid]=window[l.guid]||{},l.dom=l.dom||{},l.dom.g=function(t){return"string"==typeof t||t instanceof String?document.getElementById(t):t&&t.nodeName&&(1==t.nodeType||9==t.nodeType)?t:null},l.g=l.G=l.dom.g,l.lang=l.lang||{},l.lang.isString=function(t){return"[object String]"==Object.prototype.toString.call(t)},l.isString=l.lang.isString,l.dom._g=function(t){return l.lang.isString(t)?document.getElementById(t):t},l._g=l.dom._g,l.dom.getDocument=function(t){return t=l.dom.g(t),9==t.nodeType?t:t.ownerDocument||t.document},l.browser=l.browser||{},l.browser.ie=l.ie=/msie (\d+\.\d+)/i.test(navigator.userAgent)?document.documentMode||+RegExp.$1:void 0,l.dom.getComputedStyle=function(t,e){t=l.dom._g(t);var n,o=l.dom.getDocument(t);return o.defaultView&&o.defaultView.getComputedStyle&&(n=o.defaultView.getComputedStyle(t,null))?n[e]||n.getPropertyValue(e):""},l.dom._styleFixer=l.dom._styleFixer||{},l.dom._styleFilter=l.dom._styleFilter||[],l.dom._styleFilter.filter=function(t,e,n){for(var o,i=l.dom._styleFilter,a=0;o=i[a];a++)(o=o[n])&&(e=o(t,e));return e},l.string=l.string||{},l.string.toCamelCase=function(t){return t.indexOf("-")<0&&t.indexOf("_")<0?t:t.replace(/[-_][^-_]/g,function(t){return t.charAt(1).toUpperCase()})},l.dom.getStyle=function(t,e){var n=l.dom;t=n.g(t),e=l.string.toCamelCase(e);var o=t.style[e]||(t.currentStyle?t.currentStyle[e]:"")||n.getComputedStyle(t,e);if(!o){var i=n._styleFixer[e];i&&(o=i.get?i.get(t):l.dom.getStyle(t,i))}return(i=n._styleFilter)&&(o=i.filter(e,o,"get")),o},l.getStyle=l.dom.getStyle,l.dom._NAME_ATTRS=function(){var t={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",usemap:"useMap",frameborder:"frameBorder"};return l.browser.ie<8?(t.for="htmlFor",t.class="className"):(t.htmlFor="for",t.className="class"),t}(),l.dom.setAttr=function(t,e,n){return t=l.dom.g(t),"style"==e?t.style.cssText=n:(e=l.dom._NAME_ATTRS[e]||e,t.setAttribute(e,n)),t},l.setAttr=l.dom.setAttr,l.dom.setAttrs=function(t,e){t=l.dom.g(t);for(var n in e)l.dom.setAttr(t,n,e[n]);return t},l.setAttrs=l.dom.setAttrs,l.dom.create=function(t,e){var n=document.createElement(t),o=e||{};return l.dom.setAttrs(n,o)},l.object=l.object||{},l.extend=l.object.extend=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}}(),WORLD_SIZE_MC_HALF=20037726.372307256,WORLD_SIZE_MC=2*WORLD_SIZE_MC_HALF;var h=BMapGLLib.LuShu=function(e,n,o){!n||n.length<1||(this._map=e,o.geodesic?this.path=t(n):this.path=n,this.i=0,this._setTimeoutQuene=[],this._opts={icon:null,speed:400,defaultContent:""},o.landmarkPois||(o.landmarkPois=[]),this._setOptions(o),this._rotation=0,this._opts.icon instanceof BMapGL.Icon||(this._opts.icon=defaultIcon))};h.prototype._setOptions=function(t){if(t)for(var e in t)t.hasOwnProperty(e)&&(this._opts[e]=t[e])},h.prototype.start=function(){var t=this,e=t.path.length;if(t.i&&t.i<e-1){if(!t._fromPause)return;t._fromStop||t._moveNext(++t.i)}else t._addMarker(),t._addLine(),t._timeoutFlag=setTimeout(function(){t._addInfoWin(),""==t._opts.defaultContent&&t.hideInfoWindow(),t._moveNext(t.i)},400);this._fromPause=!1,this._fromStop=!1},h.prototype.stop=function(){this.i=0,this._fromStop=!0,clearInterval(this._intervalFlag),this._clearTimeout();for(var t=0,e=this._opts.landmarkPois,n=e.length;t<n;t++)e[t].bShow=!1},h.prototype.pause=function(){clearInterval(this._intervalFlag),this._fromPause=!0,this._clearTimeout()},h.prototype.hideInfoWindow=function(){this._overlay._div.style.visibility="hidden"},h.prototype.showInfoWindow=function(){this._overlay._div.style.visibility="visible"},l.object.extend(h.prototype,{_addMarker:function(t){this._marker&&(this.stop(),this._map.removeOverlay(this._marker),this._map.removeOverlay(this._markerL),this._map.removeOverlay(this._markerR),clearTimeout(this._timeoutFlag)),this._overlay&&this._map.removeOverlay(this._overlay),this._line&&this._map.removeOverlay(this._line);var e=new BMapGL.Marker(this.path[0]);this._opts.icon&&e.setIcon(this._opts.icon),this._map.addOverlay(e),e.setAnimation(BMAP_ANIMATION_DROP),this._marker=e;var n=new BMapGL.Marker(this.path[0],{left:!0});this._opts.icon&&n.setIcon(this._opts.icon),this._map.addOverlay(n),n.setAnimation(BMAP_ANIMATION_DROP),this._markerL=n;var o=new BMapGL.Marker(this.path[0],{right:!0});this._opts.icon&&o.setIcon(this._opts.icon),this._map.addOverlay(o),o.setAnimation(BMAP_ANIMATION_DROP),this._markerR=o},_addInfoWin:function(){var t=this,e=new r(t._marker.getPosition(),t._opts.defaultContent,t._opts.infoWinClassName);e.setRelatedClass(this),this._overlay=e,this._map.addOverlay(e)},_addLine:function(){if("none"!==this._opts.pathColor){var t=this;t._line=new BMapGL.Polyline(t.path,{strokeColor:t._opts.pathColor||"#00c0ff"}),t._map.addOverlay(t._line)}},_getMercator:function(t){return this._map.getMapType().getProjection().lngLatToPoint(t)},_getDistance:function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},_move:function(t,e,n){var o=this,i=0,a=this._opts.speed/100,r=BMapGL.Projection.convertLL2MC(t),s=BMapGL.Projection.convertLL2MC(e);r=new BMapGL.Pixel(r.lng,r.lat),s=new BMapGL.Pixel(s.lng,s.lat);var l=o._getDistance(r,s),h=null;l>30037726&&(s.x<r.x?(s.x+=WORLD_SIZE_MC,h="right"):(s.x-=WORLD_SIZE_MC,h="left"));var _=Math.round(o._getDistance(r,s)/a);if(_<1)return void o._moveNext(++o.i);o._intervalFlag=setInterval(function(){if(i>=_){if(clearInterval(o._intervalFlag),o.i>o.path.length)return;o._moveNext(++o.i),o.i>=o.path.length-1&&(o._opts.completedClear&&(o._map.removeOverlay(o._marker),o._map.removeOverlay(o._markerL),o._map.removeOverlay(o._markerR),o._map.removeOverlay(o._overlay),o._map.removeOverlay(o._line)),"function"==typeof o._opts.complete&&o._opts.complete())}else{i++;var a=n(r.x,s.x,i,_),l=n(r.y,s.y,i,_),p=BMapGL.Projection.convertMC2LL(new BMapGL.Point(a,l));if(p.lng>180&&(p.lng=p.lng-360),p.lng<-180&&(p.lng=p.lng+360),1==i){var u=null;o.i-1>=0&&(u=o.path[o.i-1]),1==o._opts.enableRotation&&o.setRotation(u,t,e,h),o._opts.autoView&&(o._map.getBounds().containsPoint(p)||o._map.setCenter(p))}o._marker.setPosition(p),o._markerL.setPosition(p),o._markerR.setPosition(p),o._setInfoWin(p),o._line&&o._line.setPath([p].concat(_toConsumableArray(o.path.slice(o.i+1)))),"function"==typeof o._opts.pass&&o._opts.pass(p)}},10)},setRotation:function(t,e,n,o){var i=this,a=0;if(e=i._map.pointToPixel(e),n=i._map.pointToPixel(n),n.x!=e.x){var r=(n.y-e.y)/(n.x-e.x);a=360*Math.atan(r)/(2*Math.PI),a=!o&&n.x<e.x||"left"===o?90-a+90:-a,i._marker.setRotation(-a),i._markerL.setRotation(-a),i._markerR.setRotation(-a)}else{var s=n.y-e.y,l=0;l=s>0?-1:1,i._marker.setRotation(90*-l),i._markerL.setRotation(90*-l),i._markerR.setRotation(90*-l)}},linePixellength:function(t,e){return Math.sqrt(Math.abs(t.x-e.x)*Math.abs(t.x-e.x)+Math.abs(t.y-e.y)*Math.abs(t.y-e.y))},pointToPoint:function(t,e){return Math.abs(t.x-e.x)*Math.abs(t.x-e.x)+Math.abs(t.y-e.y)*Math.abs(t.y-e.y)},_moveNext:function(t){var e=this;t<this.path.length-1&&e._move(e.path[t],e.path[t+1],e._tween.linear)},_setInfoWin:function(t){var e=this;if(e._overlay){e._overlay.setPosition(t,e._marker.getIcon().size);var n=e._troughPointIndex(t);-1!=n?(clearInterval(e._intervalFlag),e._overlay.setHtml(e._opts.landmarkPois[n].html),e._overlay.setPosition(t,e._marker.getIcon().size),e._pauseForView(n)):e._overlay.setHtml(e._opts.defaultContent)}},_pauseForView:function(t){var e=this,n=setTimeout(function(){e._moveNext(++e.i)},1e3*e._opts.landmarkPois[t].pauseTime);e._setTimeoutQuene.push(n)},_clearTimeout:function(){for(var t in this._setTimeoutQuene)clearTimeout(this._setTimeoutQuene[t]);this._setTimeoutQuene.length=0},_tween:{linear:function(t,e,n,o){return(e-t)*n/o+t}},_troughPointIndex:function(t){for(var e=this._opts.landmarkPois,n=0,o=e.length;n<o;n++)if(!e[n].bShow&&this._map.getDistance(new BMapGL.Point(e[n].lng,e[n].lat),t)<10)return e[n].bShow=!0,n;return-1}}),r.prototype=new BMapGL.Overlay,r.prototype.initialize=function(t){var e=this._div=l.dom.create("div",{style:"border:solid 1px #ccc;width:auto;min-width:50px;text-align:center;position:absolute;background:#fff;color:#000;font-size:12px;border-radius: 10px;padding:5px;white-space: nowrap;",class:this._infoWinClassName||""});return e.innerHTML=this._html,t.getPanes().floatPane.appendChild(e),this._map=t,e},r.prototype.draw=function(){this.setPosition(this.lushuMain._marker.getPosition(),this.lushuMain._marker.getIcon().size)},l.object.extend(r.prototype,{setPosition:function(t,e){var n=this._map.pointToOverlayPixel(t),o=l.dom.getStyle(this._div,"width"),i=l.dom.getStyle(this._div,"height"),a=parseInt(this._div.clientWidth||o,10);parseInt(this._div.clientHeight||i,10);this._div.style.left=n.x-a/2+"px",this._div.style.bottom=-(n.y-e.height)+"px"},setHtml:function(t){this._div.innerHTML=t},setRelatedClass:function(t){this.lushuMain=t}})}();
